# 天瀚國際科技 資深全端工程師問卷問題
===

# Backend
### 1. 請實作下列需求
假設目前有個需求，需要透過多個號源站抓取各彩種指定期號的中獎號碼
可使用 Laravel 或您熟悉的程式語言，請設計出架構，實現剛好滿足需求並具有擴充性程式碼
#### 回答：
> 1.相關程式放在`src/`內，主程式為`UpdateWinningNumberJob.php`，
> 彩種及訊號源分別在`Lottery/`與`Signal/`中做管理並透過繼承`AbstractLottery`與`AbstractSignal`實現擴充機制。  
> 2.比對主訊號源及其他訊號源開獎號碼的程式實作在`SignalCenter`中，各訊號源只要回傳對應期號的開獎結果字串即可。

### 2. 上面程式或規格可能存在什麼潛在問題？還可以怎樣優化？
#### 回答：
> 1.目前的設計僅比對結果字串，並未考慮排序問題，假設訊號源給予的獎號順序不同，將比對不出相同結果，導致一直回傳空字串，這部分需要事前溝通規劃好，方可避免。  
> 2.因比對訊號源會按照`SignalCenter->signals`中的順序進行查詢，直到查到相同結果才終止，所以排序較前面的訊號源會較頻繁查詢，如果要分散查詢可能會改用隨機抽一家訊號源查詢的方式做調整。  
> 3.目前實作並未考慮到非同步非阻塞地向訊號源查詢資料，因此會有可能因為訊號源而卡住整個程序。
> 如果要改為非同步查詢，則需改寫成發出請求後等待個訊號源回應，收到回應後執行callback檢查是否與主訊號源結果相同。

### 3. 如果要加入第三家號源，會怎麼進行擴充？
#### 回答：
> 如第一題所示，在`Signal/`中新增一個類別繼承`AbstractSignal`並撰寫相關屬性及方法即可。

### 4. 每個號源有不同的速率限制，會如何實現限流，防止被 ban？
假設號源一限制 5 秒一次，號源二限制 3 秒一次，同號源不同彩種是分開計算的
#### 回答：
> 在每個訊號源中的屬性設定速率限制秒數，並在收到查詢結果後紀錄時間，下次發送請求時先比對時間，並應等待到下次可發出請求的時間再發送請求。

### 5. 開獎時間並非準時，您會如何實現重試機制？
號源站並非能第一時間抓到該彩種中獎號碼，因此存在抓不到的可能性
#### 回答：
> 1.我會將比對查詢結果的排程跟查詢各訊號源各彩種的排程分開執行。  
> 2.查詢的排程如果查詢不到結果時就依照第四題提到的速率限制重複查詢，直到有結果時把資料存起來(檔案或資料庫)  
> 3.比對的排程則定時重複執行，一直檢查第二點存下來的資料，比對尚未有開獎結果的彩種，直到所有彩種開獎結束。

### 6. 可以實現哪些手段來減少程式運行時間？
#### 回答：
> 1.使用非同步的方式向所有訊號源查詢結果。  
> 2.減少程式中的迴圈，並且在有結果時即中斷迴圈，減少多餘的查詢及比對。  
> 3.確保與訊號源間的網路順暢。
